<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SCNG • NL Batting Title Race</title>

  <!-- (Optional but nice if you share the embed URL anywhere) -->
  <meta property="og:title" content="NL Batting Title Race — SCNG" />
  <meta property="og:description" content="Live leaderboard of qualified NL hitters by batting average." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg: #0b1020;
      --card: #121833;
      --muted: #9fb3c8;
      --text: #f4f8ff;
      --accent: #1ea8ff;    /* default SCNG accent */
      --accent-2:#36d19e;
      --sep: rgba(255,255,255,0.08);
    }
    /* Brand accents by referrer (11 SCNG sites + fallback) */
    .brand-ocregister { --accent:#ff6a00; }
    .brand-dailynews { --accent:#c41200; }
    .brand-pe        { --accent:#0d7a5f; }
    .brand-presstelegram { --accent:#0073cf; }
    .brand-sbsun     { --accent:#005596; }
    .brand-redlands  { --accent:#8c3a00; }
    .brand-sgvtribune{ --accent:#004b8d; }
    .brand-whittier  { --accent:#6d2c91; }
    .brand-pasadena  { --accent:#004c97; }
    .brand-dailybulletin { --accent:#0b6a88; }
    .brand-dailypilot    { --accent:#1ea8ff; }

    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    a{color:inherit}
    .shell{max-width:760px;margin:0 auto;padding:14px}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));
      border:1px solid var(--sep); border-radius:18px; padding:12px 12px 10px;
      box-shadow:0 10px 30px rgba(0,0,0,.35)
    }
    .hdr{display:flex;align-items:center;gap:10px;margin:4px 2px 10px}
    .badge{font-size:11px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted);border:1px solid var(--sep);padding:4px 8px;border-radius:999px}
    .title{font-weight:800;font-size:18px;line-height:1.1}
    .sub{font-size:12px;color:var(--muted)}
    .grid{width:100%;border-collapse:collapse;margin-top:10px}
    .grid th,.grid td{padding:10px 8px;border-bottom:1px solid var(--sep);font-size:14px}
    .grid th{font-size:12px;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);text-align:left}
    .grid td.num{text-align:right;font-variant-numeric:tabular-nums}
    .row{display:flex;align-items:center;gap:10px}
    .rank{width:22px;height:22px;display:inline-grid;place-items:center;border-radius:6px;background:rgba(255,255,255,.06);font-weight:700;font-size:12px}
    .logo{width:26px;height:26px;border-radius:6px;background:#0a0f20;display:grid;place-items:center;overflow:hidden;border:1px solid var(--sep)}
    .logo img{width:22px;height:22px;display:block}
    .name{font-weight:700}
    .team{color:var(--muted);font-size:12px}
    .lead{font-size:12px;color:var(--muted)}
    .foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px;padding-top:10px;border-top:1px solid var(--sep)}
    .btn{
      appearance:none;border:0;background:var(--accent);color:#001222;
      padding:8px 12px;border-radius:999px;font-weight:800;font-size:12px;cursor:pointer
    }
    .btn.secondary{background:transparent;color:var(--muted);border:1px solid var(--sep)}
    .err{color:#ffb4b4}
    @media (max-width:480px){
      .grid th.hide-sm,.grid td.hide-sm{display:none}
      .title{font-size:16px}
    }
  </style>
</head>
<body>
  <div id="app" class="shell">
    <div class="card">
      <div class="hdr">
        <span class="badge">NL • Leaders</span>
        <div>
          <div class="title">Batting Title Race (Qualified)</div>
          <div class="sub" id="asof">Loading…</div>
        </div>
      </div>

      <table class="grid" id="tbl">
        <thead>
          <tr>
            <th>#</th>
            <th>Player</th>
            <th class="hide-sm">Team</th>
            <th class="num">AVG</th>
            <th class="num hide-sm">H</th>
            <th class="num hide-sm">AB</th>
          </tr>
        </thead>
        <tbody id="rows">
          <tr><td colspan="6" class="sub">Fetching leaders…</td></tr>
        </tbody>
      </table>

      <div class="foot">
        <button id="refresh" class="btn secondary">Refresh</button>
        <div class="lead" id="lead"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  // --- Brand accent by parent site (referrer) ---
  try {
    const ref = document.referrer || '';
    const host = ref.split('/')[2] || '';
    const map = [
      [/ocregister\.com/i,'brand-ocregister'],
      [/dailynews\.com/i,'brand-dailynews'],
      [/pe\.com/i,'brand-pe'],
      [/presstelegram\.com/i,'brand-presstelegram'],
      [/sbsun\.com/i,'brand-sbsun'],
      [/redlandsdailyfacts\.com/i,'brand-redlands'],
      [/sgvtribune\.com/i,'brand-sgvtribune'],
      [/whittierdailynews\.com/i,'brand-whittier'],
      [/pasadenastarnews\.com/i,'brand-pasadena'],
      [/dailybulletin\.com/i,'brand-dailybulletin'],
      [/dailypilot\.com/i,'brand-dailypilot']
    ];
    const cls = (map.find(([re])=>re.test(host))||[])[1];
    if(cls) document.documentElement.classList.add(cls);
  } catch(e){}

  const rowsEl = document.getElementById('rows');
  const asofEl = document.getElementById('asof');
  const leadEl = document.getElementById('lead');
  const btn = document.getElementById('refresh');

  function seasonForToday(){
    const d = new Date();
    const m = d.getUTCMonth()+1; // 1-12
    // MLB reg season opens late Mar/early Apr; if Jan-Feb, show previous year
    return (m<=2) ? d.getUTCFullYear()-1 : d.getUTCFullYear();
  }

  function fmtAvg(x){
    if (x==null) return '—';
    const n = typeof x === 'string' ? parseFloat(x) : x;
    if (isNaN(n)) return '—';
    return n.toFixed(3).replace(/^0/,''); // .342 style
  }
  function c(u){ return document.createElement(u); }
  function teamLogo(teamId){ return `https://www.mlbstatic.com/team-logos/team-cap-on-dark/${teamId}.svg`; }

  async function fetchLeaders(){
    const season = seasonForToday();
    // Stats API: qualified NL hitters, sorted by battingAverage (regular season)
    const url = `https://statsapi.mlb.com/api/v1/stats` +
      `?stats=season&group=hitting&season=${season}` +
      `&leagueId=104&playerPool=Qualified&gameType=R` +
      `&sortStat=battingAverage&order=desc&limit=10` +
      `&hydrate=person(team)&_=${Date.now()}`;

    const r = await fetch(url, {mode:'cors', cache:'no-store'});
    if(!r.ok) throw new Error('Network error '+r.status);
    const data = await r.json();
    const splits = (data?.stats?.[0]?.splits)||[];
    return splits.map((s,i)=>({
      rank: i+1,
      player: s?.player?.fullName || s?.person?.fullName || '—',
      team: s?.team?.abbreviation || s?.team?.teamCode || '',
      teamId: s?.team?.id,
      avg: parseFloat(s?.stat?.avg ?? s?.stat?.battingAverage ?? 0),
      hits: +s?.stat?.hits || 0,
      ab: +s?.stat?.atBats || 0
    }));
  }

  function render(rows){
    rowsEl.innerHTML='';
    rows.slice(0,10).forEach(r=>{
      const tr = c('tr');
      const tdRank = c('td'); tdRank.innerHTML = `<span class="rank">${r.rank}</span>`;
      const tdPlayer = c('td');
      tdPlayer.innerHTML = `
        <div class="row">
          <span class="logo">${r.teamId?`<img alt="" src="${teamLogo(r.teamId)}" />`:''}</span>
          <div>
            <div class="name">${r.player}</div>
            <div class="team">${r.team||''}</div>
          </div>
        </div>`;
      const tdTeam = c('td'); tdTeam.className='hide-sm'; tdTeam.textContent = r.team||'';
      const tdAvg = c('td'); tdAvg.className='num'; tdAvg.textContent = fmtAvg(r.avg);
      const tdH   = c('td'); tdH.className='num hide-sm'; tdH.textContent = r.hits.toString();
      const tdAB  = c('td'); tdAB.className='num hide-sm'; tdAB.textContent = r.ab.toString();
      tr.append(tdRank, tdPlayer, tdTeam, tdAvg, tdH, tdAB);
      rowsEl.append(tr);
    });

    if (rows.length >= 2){
      const lead = (rows[0].avg - rows[1].avg);
      leadEl.textContent = `Lead over #2: ${lead>0?fmtAvg(lead):'.000'}`;
    } else {
      leadEl.textContent = '';
    }
    const now = new Date();
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'America/Los_Angeles';
    const fmt = new Intl.DateTimeFormat('en-US',{dateStyle:'medium', timeStyle:'short', timeZone:tz});
    asofEl.textContent = `As of ${fmt.format(now)} • Regular season • NL (Qualified)`;
  }

  async function run(){
    try{
      btn.disabled = true;
      const rows = await fetchLeaders();
      render(rows);
    } catch(err){
      rowsEl.innerHTML = `<tr><td colspan="6" class="err">Couldn’t load leaders. ${err.message}. <button class="btn" onclick="location.reload()">Retry</button></td></tr>`;
      console.error(err);
    } finally {
      btn.disabled = false;
    }
  }

  btn.addEventListener('click', run);
  run();
  // Refresh every 5 minutes
  setInterval(run, 5*60*1000);
})();
</script>
</body>
</html>
