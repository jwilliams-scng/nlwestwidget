<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCNG • NL West Standings</title>

  <style>
    :root { color-scheme: light only; }

    html, body { margin:0; padding:0; }
    body {
      padding: 12px; /* original padding on all sides */
      font: 14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: #fff;
      overflow-x: hidden;
    }

    .wrap { max-width: 740px; margin: 0 auto; }

    .card {
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      box-shadow: 0 1px 2px rgba(0,0,0,.04);
      overflow: hidden;
    }

    header {
      display:flex;justify-content:space-between;align-items:center;
      padding:12px;
      background:linear-gradient(90deg,var(--p,#0d47a1),var(--a,#1976d2));
      color:#fff;
    }
    header h3 { margin:0; font-size:16px; letter-spacing:.2px; font-weight:800; }
    header .meta { font-size:12px; opacity:.95; }

    .body { padding:12px; }
    .note { font-size:12px; color:#6b7280; margin:6px 0 12px; }

    /* race strip */
    .race { padding: 6px 0 12px; }
    .race .row { display:flex; justify-content:space-between; gap:12px; }
    .race .bar { height:10px; background:#e5e7eb; border-radius:999px; position:relative; overflow:hidden; margin:8px 0; }
    .race .fill { position:absolute; top:0; bottom:0; width:50%; background:#fff; opacity:.7; transition:width .3s ease; }
    .race .mini { display:flex; justify-content:space-between; font-size:12px; color:#475569; }

    /* table */
    table { width:100%; border-collapse:separate; border-spacing:0; font-size:14px;
            border-bottom:1px solid #e5e7eb; } /* bottom divider */
    th, td {
      padding:10px 12px; text-align:left; border-bottom:1px solid #e5e7eb;
      vertical-align:middle; white-space:nowrap;
    }
    tbody tr:last-child td { border-bottom:0; } /* avoid double line */
    th {
      font-size:12px; text-transform:uppercase; letter-spacing:.06em;
      color:#6b7280; background:#fafafa; position:sticky; top:0;
    }
    tbody tr:nth-child(even) { background:#f6f7f9; }
    tbody tr.leader { background:#fff7cc; }
    td.num { text-align:right; font-variant-numeric:tabular-nums; }

    @media (max-width:480px){
      th.hide-sm, td.hide-sm { display:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h3>NL West Standings</h3>
        <div class="meta"></div>
      </header>

      <div class="body">
        <div class="race">
          <div class="row" id="heads"></div>
          <div class="bar"><div class="fill" id="fill"></div></div>
          <div class="mini"><div id="leadline"></div><div id="magic"></div></div>
        </div>

        <table aria-label="NL West standings">
          <thead>
            <tr>
              <th>#</th>
              <th>Team</th>
              <th class="num">W</th>
              <th class="num">L</th>
              <th class="num">PCT</th>
              <th class="num">GB</th>
            </tr>
          </thead>
          <tbody id="rows">
            <tr><td colspan="6" class="note">Loading standings…</td></tr>
          </tbody>
        </table>

        <div class="note" id="asof"></div>
      </div>
    </div>
  </div>

  <script>
  (async () => {
    /* ---------- Branding ---------- */
    const brandMap = {
      'dailynews.com':'ladn','ocregister.com':'ocr','sgvtribune.com':'sgv','dailybreeze.com':'db',
      'presstelegram.com':'pt','sbsun.com':'sbs','dailybulletin.com':'ivdb','pasadenastarnews.com':'psn',
      'whittierdailynews.com':'wdn','dailypilot.com':'dp'
    };
    const brandColors = {
      ladn:['#0d47a1','#1976d2'], ocr:['#0b3d91','#1e88e5'], sgv:['#334155','#64748b'],
      db:['#0f766e','#14b8a6'], pt:['#1f2937','#4b5563'], sbs:['#7c2d12','#ea580c'],
      ivdb:['#3b0764','#7c3aed'], psn:['#111827','#374151'], wdn:['#27272a','#52525b'],
      dp:['#1e3a8a','#2563eb'], default:['#0d47a1','#1976d2']
    };
    const qs = new URLSearchParams(location.search);
    const force = (qs.get('brand')||'').toLowerCase();
    let host=''; try{ host=new URL(document.referrer).hostname.toLowerCase().replace(/^www\./,''); }catch(e){}
    const [p,a] = (brandColors[force || brandMap[host] || 'default'] || brandColors.default);
    document.documentElement.style.setProperty('--p', p);
    document.documentElement.style.setProperty('--a', a);

    /* ---------- Meta ---------- */
    const meta = document.querySelector('.meta');
    const now = new Date();
    const season = (now.getUTCMonth()+1)<=2 ? now.getUTCFullYear()-1 : now.getUTCFullYear();
    meta.textContent = `${season} • Updated ${now.toLocaleString(undefined,{hour:'2-digit',minute:'2-digit',month:'short',day:'numeric'})}`;

    /* ---------- Elements ---------- */
    const rowsEl = document.getElementById('rows');
    const headsEl = document.getElementById('heads');
    const fillEl  = document.getElementById('fill');
    const leadEl  = document.getElementById('leadline');
    const magicEl = document.getElementById('magic');
    const asofEl  = document.getElementById('asof');

    const pct3 = n => (isFinite(n) ? Number(n).toFixed(3).replace(/^0/,'') : '—');

    /* ---------- Fetch NL West standings ---------- */
    async function getNLWest() {
      const u = `https://statsapi.mlb.com/api/v1/standings?leagueId=104&season=${season}&standingsTypes=byDivision`;
      const r = await fetch(u,{mode:'cors',cache:'no-store'});
      const j = await r.json();
      const recs = j?.records || [];
      // divisionId: 203 is NL West
      const west = recs.find(x => x?.division?.id === 203) || recs.find(x => /west/i.test(x?.division?.name||'') && x?.league?.id===104);
      const teams = (west?.teamRecords || []).map(t => ({
        id: t?.team?.id,
        name: t?.team?.name,
        abbr: t?.team?.abbreviation || t?.team?.teamCode,
        w: +t?.wins || 0,
        l: +t?.losses || 0,
        pct: +t?.winningPercentage || 0,
      }));
      teams.sort((a,b)=> (b.pct - a.pct) || (b.w - a.w));
      // compute GB values
      const lead = teams[0];
      teams.forEach(t => {
        const gb = ((lead.w - t.w) + (t.l - lead.l)) / 2;
        t.gb = t===lead ? '-' : (gb % 1 === 0 ? gb.toFixed(0) : gb.toFixed(1));
      });
      return teams;
    }

    const data = await getNLWest();
    if (!data.length) {
      rowsEl.innerHTML = `<tr><td colspan="6" class="note">Standings temporarily unavailable.</td></tr>`;
      asofEl.textContent = '';
      return;
    }

    /* ---------- Race: Dodgers vs Padres ---------- */
    const LAD = data.find(t => t.abbr === 'LAD') || { w:0, l:0, gb:'-' };
    const SD  = data.find(t => t.abbr === 'SD')  || { w:0, l:0, gb:'-' };

    headsEl.innerHTML =
      `<div><strong>Dodgers</strong> ${LAD.w}-${LAD.l} GB ${LAD.gb}</div>` +
      `<div><strong>Padres</strong> ${SD.w}-${SD.l} GB ${SD.gb}</div>`;

    // progress bar: center 50%, shift by games lead (clamped)
    const gbNum = SD.gb==='-' ? 0 : parseFloat(SD.gb);
    const dir = (LAD.gb==='-' ? 1 : -1);
    const shift = Math.max(-4, Math.min(4, (dir * gbNum)));
    fillEl.style.width = `${50 + shift * 5}%`;

    // magic number relative to 2nd place
    const leader = data[0];
    const runner = data[1] || data[0];
    const magic = Math.max(0, 163 - leader.w - runner.l);
    leadEl.textContent  = `${leader.name.split(' ')[0]} lead by ${runner.gb === '-' ? '—' : runner.gb + ' games'}`;
    magicEl.textContent = `Magic number: ${isFinite(magic) ? magic : '—'}`;

    /* ---------- Table ---------- */
    rowsEl.innerHTML = data.map((t,i)=>`
      <tr class="${i===0?'leader':''}">
        <td>${i+1}</td>
        <td>${t.name}</td>
        <td class="num">${t.w}</td>
        <td class="num">${t.l}</td>
        <td class="num">${pct3(t.pct)}</td>
        <td class="num">${t.gb}</td>
      </tr>
    `).join('');

    /* ---------- Footer ---------- */
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'America/Los_Angeles';
    const fmt = new Intl.DateTimeFormat('en-US',{dateStyle:'medium', timeStyle:'short', timeZone:tz});
    asofEl.textContent = `As of ${fmt.format(now)} • Regular season • NL West`;
  })();
  </script>
</body>
</html>
